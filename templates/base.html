<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Görev & Not</title>
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🤖</text></svg>">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- ÖNERİ: Yeni, samimi fontlar -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
<div class="app d-flex">

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
      <div class="d-flex align-items-center gap-2">
        <h2 class="fs-5 mb-0 text-primary fw-bold sidebar-brand">Menü</h2>
      </div>
      <button class="btn btn-outline-secondary" id="toggleSidebar">
        <i class="bi bi-list"></i>
      </button>
    </div>

    <nav id="main-nav" class="nav flex-column">
      <h6 class="sidebar-heading text-muted mt-2 mb-1">NOTLARIM</h6>
      <a class="nav-item nav-link" href="#" id="link-all-notes"><i class="bi bi-journal-text"></i> <span class="sidebar-text">Tüm Notlar</span></a>
      <a class="nav-item nav-link" href="#" id="link-starred-notes"><i class="bi bi-star"></i> <span class="sidebar-text">Yıldızlı Notlar</span></a>
      <a class="nav-item nav-link" href="#" id="link-add-note"><i class="bi bi-plus-circle"></i> <span class="sidebar-text">Yeni Not Ekle</span></a>
      <hr class="my-2 border-secondary opacity-25">
      <h6 class="sidebar-heading text-muted mt-3 mb-1">GÖREVLERİM</h6>
      <a class="nav-item nav-link" href="#" id="link-all-tasks"><i class="bi bi-list-task"></i> <span class="sidebar-text">Tüm Görevlerim</span></a>
      <a class="nav-item nav-link" href="#" id="link-upcoming-tasks"><i class="bi bi-alarm"></i><span class="sidebar-text">Yaklaşan Görevler</span></a>
      <a class="nav-item nav-link" href="#" id="link-overdue-tasks"><i class="bi bi-calendar-x text-danger"></i><span class="sidebar-text">Gecikmiş Görevler</span></a>
      <a class="nav-item nav-link" href="#" id="link-starred-tasks"><i class="bi bi-star-fill"></i><span class="sidebar-text">Yıldızlı Görevler</span></a>
      <a class="nav-item nav-link" href="#" id="link-completed-tasks"><i class="bi bi-check2-square"></i> <span class="sidebar-text">Tamamlanan Görevler</span></a>
      <a class="nav-item nav-link" href="#" id="link-add-task"><i class="bi bi-calendar-plus"></i> <span class="sidebar-text">Yeni Görev Ekle</span></a>
      <hr class="my-2 border-secondary opacity-25">
    </nav>

    <h6 class="sidebar-heading text-muted mt-2 mb-1">ETİKETLERİM</h6>
    <nav id="tags-list-container" class="nav flex-column">
      <!-- Etiketler buraya dinamik olarak eklenecek -->
    </nav>
    <hr class="my-2 border-secondary opacity-25">
    
  </aside>

  <main class="main flex-fill">                             
    <header class="topbar p-3 shadow-sm d-flex justify-content-between align-items-center">
      
      <div class="d-flex align-items-center flex-grow-1">
        <div class="topbar-brand me-4">
          <div class="d-flex align-items-center gap-2" style="height: 36px;"> {# Yüksekliği user-icon ile eşleştir #}
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Uygulama Logosu" style="height: 100%; width: auto;">
            <h2 class="fs-5 mb-0 text-primary fw-bold">Görev & Not</h2>
          </div>
        </div>
        <!-- ARAMA ÇUBUĞU (Başlangıçta gizli) -->
        <div id="search-container" class="d-none">
            <input type="search" id="search-input" class="form-control form-control-sm" placeholder="Not veya görev ara...">
        </div>
      </div>
  
  {% if current_user.is_authenticated %}
    <div class="dropdown">
      <div id="user-avatar-container" class="user-icon" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer;">
        {% if current_user.avatar %}
          <img src="{{ url_for('static', filename='img/avatars/' + current_user.avatar) }}" alt="Avatar" class="rounded-circle w-100 h-100" style="object-fit: cover;">
        {% else %}
          <span class="user-initials">{{ current_user.username[:2].upper() }}</span>
        {% endif %}
      </div>
      
      <ul class="dropdown-menu dropdown-menu-end p-0" aria-labelledby="userDropdownToggle" style="min-width: 300px;">
        <li class="p-3 bg-light border-bottom">
            <div class="d-flex align-items-center">
                <div class="user-icon me-3" style="width: 40px; height: 40px;">
                  {% if current_user.avatar %}
                    <img src="{{ url_for('static', filename='img/avatars/' + current_user.avatar) }}" alt="Avatar" class="rounded-circle w-100 h-100" style="object-fit: cover;">
                  {% else %}
                    <span class="user-initials">{{ current_user.username[:2].upper() }}</span>
                  {% endif %}
                </div>
                <div>
                    <h6 class="mb-0 fw-bold">{{ current_user.username }}</h6>
                    <small class="text-muted">{{ current_user.email }}</small>
                </div>
            </div>
        </li>

        <li id="user-stats-area" class="p-3">
            <div class="text-center text-muted py-3">Yükleniyor...</div>
        </li>

        <li><hr class="dropdown-divider my-0"></li>
        
        <li class="p-3">
            <h6 class="dropdown-header px-0">Tema Seçimi</h6>
            <div class="btn-group w-100" role="group" aria-label="Tema Seçimi">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-theme-value="light"><i class="bi bi-sun-fill me-1"></i> Işık</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" data-theme-value="dark"><i class="bi bi-moon-stars-fill me-1"></i> Karanlık</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" data-theme-value="forest"><i class="bi bi-tree-fill me-1"></i> Orman</button>
            </div>
        </li>

        <li><hr class="dropdown-divider my-0"></li>

        <li>
            <a class="dropdown-item" href="#" id="link-avatars">
                <i class="bi bi-person-circle me-2"></i> Avatarlarım
            </a>
        </li>
        <li>
            <a class="dropdown-item" href="#" id="link-badges">
                <i class="bi bi-award me-2"></i> Rozetlerim
            </a>
        </li>
        <li>
            <a class="dropdown-item" href="#" id="link-settings">
                <i class="bi bi-gear me-2"></i> Hesap Ayarları
            </a>
        </li>
        <li>
            <a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}" id="logout-link">
                <i class="bi bi-box-arrow-right"></i> Çıkış Yap
            </a>
        </li>
      </ul>
    </div>
  {% endif %}
</header>

    <div id="mainContent">
      <div class="container-fluid py-4">
        <h3>Hoş geldin, {{ current_user.username }} 👋</h3>
        <p class="text-muted">Lütfen sol menüden bir seçenek seçiniz.</p>
      </div>
    </div>
  </main>
</div>

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
  <div id="toast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toast-body">Mesaj</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Kapat"></button>
    </div>
  </div>
</div>

{% if show_welcome_modal %}
<!-- YENİ: Motivasyon Modalı -->
<div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header border-0">
        <h5 class="modal-title w-100" id="welcomeModalLabel">Tekrar Hoş Geldin, {{ current_user.username }}!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body py-4">
        <p class="fs-5"><em>"{{ motivational_message }}"</em></p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Devam Et</button>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- YENİ: Rozet Kazanma Modalı -->
<div class="modal fade" id="badgeEarnedModal" tabindex="-1" aria-labelledby="badgeEarnedModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header border-0">
        <h5 class="modal-title w-100" id="badgeEarnedModalLabel">🎉 Tebrikler! Yeni Rozet Kazandın! 🎉</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
      </div>
      <div class="modal-body py-4">
        <i id="badgeModalIcon" class="bi" style="font-size: 5rem; color: var(--success-color);"></i>
        <h4 id="badgeModalName" class="mt-3 fw-bold"></h4>
        <p id="badgeModalDescription" class="text-muted"></p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Harika!</button>
      </div>
    </div>
  </div>
</div>

<!-- YENİ: AI Asistanı -->
<div id="ai-assistant">
  <div id="assistant-bubble" class="assistant-bubble">
    <span id="assistant-message">Merhaba! Yardıma ihtiyacın var mı?</span>
  </div>
  <div id="assistant-avatar" class="assistant-avatar">
    <i class="bi bi-robot"></i>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<!-- YENİ: Konfeti animasyonu için eklendi -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>

</body>
</html>